<center>
	<h1>P0: Refreshing Your Background</h1>
	<h3>CMPSC 473, FALL 2018</h3>
	<p><font color="red">This project is not for evaluation. This is to familiarize
	yourself with the tools and commands used in this course.</font></p>
</center>
<hr/>
<h2>Machines and tools</h2>
<p>All the projects in this course are to be run and tested on the linux machines in lab W204.
	To connect to these machines,
	open an ssh terminal (or an equivalent software in your OS (e.g putty in Windows))
	and use the following command: <br/>
	<code>$ ssh username@cse-p204instxx.cse.psu.edu</code><br />
	where <span class="math"><em>u</em><em>s</em><em>e</em><em>r</em><em>n</em><em>a</em><em>m</em><em>e</em></span>
	is your CSE username and <span class="math"><em>x</em><em>x</em></span>
	is the machine number (e.g 04).<br />
	Proceed with the authentication (your password or 2FA) and you will be logged in.</p>
<!--
 if you are inside the department network, first use the Cisco AnyConnect VPN to establish a VPN, otherwise you don&rsquo;t need a VPN.
-->
<p>
All the projects in this course will allow up to 2 students per team and to ease
collaboration within the team, we are planning to use
<a href="https://classroom.github.com/">github classroom</a>
as the platform for disemminating code stubs and files related to the project,
as well as allowing collaborations (within teams).
So, we first go through some important and useful commands to configure your respective git environment.
</p>
<h3>What is git?</h3>
<a href="https://en.wikipedia.org/wiki/Git">Git</a> is a version control system
(typically hosted on, <a href="github.com">Github.com</a>)
for (i) tracking changes (and reverting to previous versions) in multiple files and
(ii) collaborating with multiple users.

<h3>Signing Up</h3>
If not done already, each student should sign up on <a href="github.com">GitHub.com</a> to register and get their individual usernames.

<h3>Configuring your local git environment</h3>
To configure a git enviroment (in any of the lab W204 machines), set the username and email using following commands:<br/>
 <code>
  $ git config --global user.name "Your Username"<br/>
  $ git config --global user.email "Your Email"<br/>
</code>

<h3>Adding SSH key</h3>
In order to authenticate your Git user while cloning the repository you need to add your public SSH key to your git account. To do so, follow the steps below:
<ol>
  <li>Create a SSH key by running this command:<br/>
  <code>
  $ ssh-keygen -t rsa -b 4096 -C "your@email.com"
  </code>
  </li>
 <li> It will ask for a path to store the key generated and password protection for the key file. Press Enter on any question to select default answer.
  </li>
  <li> If you selected the default answer, your public SSH key will be created in <code>$ &sim;/.ssh/id_rsa.pub</code>. Else, it will be in the path you chose for the file. Copy it's content.
  </li>
  <li>Go to your GitHub account, go to settings, in left-side menu select SSH key, and paste your public key there.
</li>
</ol>
<hr/>
<h2>Working on your project</h2>
After configuring the Git environment, you can clone the project (in this example, P0) files and start working on it.
For each project (P1, P2, and P3), we will release an invitation link to join a github classroom as below:
<h3>Invitation link for P0:</h3>
<p><a href="https://classroom.github.com/a/VtsWevms">https://classroom.github.com/a/VtsWevms</a></p>

<h3>Accepting the project</h3>
<p>Click on the invitation link above and then accept the project. By accepting the invitation, you will have access to  your  private  repository
containing  the  starter  files provided as a part of the project (it has the source codes, manuals and scripts for the project).
</p><p>The link for your repository is: "https://github.com/psu473/px-< your-github-username >"</p>
<p>where x is the project number (here 0) </p>
<strong>Note:</strong> This private repository is a copy of a public starter repository at https://github.com/psu473/p<i>x</i> where x is project number.
Please stay tuned constantly to the canvas page for the exact and latest interface
functions you need to implement, their arguments, test programs, examples, documentation/manuals and announcements.<br/>

<p> To get the latest update, follow the steps below:</p>
<ol>
	<li>Put here the commands</li>
</ol>
These commands enbale you to merge the changes and updates we pushed into the public repository with your current working private repository (e.g p0-< your-github-username >).


<h3>Adding your teammate</h3>
<p style="color:red">
Since all the course projects can be done in groups of up to 2 members, we next list the steps to follow to add your team member.<br/>
<strong >Note:</strong> One person per team is required to
accept the invitation link and then add the other team member to the repository as
described below.<br/>
If you accept the invitation and do not need the repository (in case you
joined a team that already has a repository) let us know, so as to remove the
repository.</p>

To add your team-member to your private repository, go to your
repository in GitHub and follow the instructions below:
<ol>
  <li> Click on settings menu (on the upper right side) </li>

  <li> In the left side panel, click on "Collaborators &amp; teams". In the collaborator
  section, add your teammate's GitHub username OR his/her email.</li>
</ol>


<h3>Cloning the project</h3>

Now that a private (remote) repository is created for your team on GitHub.com to start working on the project both team members need to clone the project to their respective local machines. To do so, use the following command:
<br/><br/>
  <code>
  $ git clone git@github.com:PSU473/px-&lt;yourGitHubUsername&gt;.git
  </code>
<br/>
<p>where x is the project number (starting from 0).</p>

<p>This command will download the repository to your current working directory.</p>

<h3>Collaborating with your teammate(s)</h3>
<p>To simultaneously work on the  same  project, team members
need  to create a branch from the master branch and do their work at their own branch.</p>
  <p> On completion, merge in the individual branches into the master branch (described below).
	</p><p>To create your branch use the following command:</p>
	<p><code>$ git branch &lt; your-branch-name &gt; </code></p>
	<p>To list all branches, use the following command:</p>
	<p><code>$ git branch -a </code></p>
	<p>Now, to switch to your new branch, use the following command:</p>
	<p><code>$ git checkout &lt; your-branch-name &gt; </code></p>
	<p>To push your new branch using the following command:</p>
	<p><code>$ git push origin &lt; your-branch-name &gt; </code></p>


<h3>Working with the repository</h3>
<p>Prior to making changes in the project, make sure that you are in the correct branch.</p>
<p>To see which branch you currently are at use the following command:</p>
<p><code>$ git branch -a</code></p>

<p>As mentioned before, you will see all the branches of this repo listed.
The current branch is marked by an * sign next to the branch name.
If the current branch is not your branch name, switch to the correct
branch using the following command:</p>

<p><code>$ git checkout &lt; your-branch-name &gt; </code></p>

<p>Now that your branch is ready, you can start making changes into the project.</p>
<p>Any changes or additions to your local repository must be pushed
to the remote version of repository on GitHub. To see whether your local
repository is up to date or not, enter these commands:</p>

<p><code>$ cd &lt; downloaded repo. &gt; </code></p>
<p><code>$ git status</code></p>

<p>The output of latter command tells you the status of your local repo.</p>

<hr/>
<h2 id="sec:start">Getting Started With P0</h2>
<p>The repository for P0 containins all the files needed for completing P0. When you open this repository, you will find a folder, named prog1. This folder contains the files described below in task 1 description.</p>
<h3>Compiling the project</h3>
<ol>
<li>
<p>To compile a source code into an executable file we use the <span class="math"><em>g</em><em>c</em><em>c</em></span> compiler.</p>
</li>
<li>
<p>To use gcc, type the following:<br />$ gcc program.c -o out<br />
Here, gcc compiles the source file <span class="math"><em>p</em><em>r</em><em>o</em><em>g</em><em>r</em><em>a</em><em>m</em>.<em>c</em></span> and creates an executable file called <span class="math"><em>o</em><em>u</em><em>t</em></span>.</p>
</li>
<li>
<!-- Adithya: I am not sure this is an accurate reason for using makefile. We use a Makefile to hide the details of the compilation process,
not reduce the time to type the command sequence. Bash history is a good substitute for that. -->


<p>The gcc command can take multiple command line arguments and typing it every time can become time consuming. For example, to compile the code using 32/64 bit options, we can add the -m&lt;architecture&gt; flag to the command. E.g., to compile with the 32 bit option:<br /><code>$ gcc -g -m32 program.c -o out</code></p>
</li>
<li>
<p>To ease the compilation process and not type a verbose command sequence every time we compile, we use the <span class="math"><em>m</em><em>a</em><em>k</em><em>e</em></span> utility. This uses a 'Makefile' where we can specify a list of commands directed towards a specific label (e.g., default, clean, prog1 labels in p0/prog1). If a project comes with a Makefile, using the following command will execute the default action:<br />$ make</p>
</li>
</ol>

<h3>How to run the project? </h3>
	<p>Once you compile the project and create an executable file (eg. <i>out</i> in above example),
	to execute that file use the following command:<br />
		<code>$ ./out [command line arguments if needed]</code></p>


<p>How to debug a program?<br />To debug a program we use <span class="math"><em>g</em><em>d</em><em>b</em></span> utility. Here is what you will need:</p>
<ol>
<li>
<p>To run a program prog1 under gdb, simply execute<br />$ gdb prog1</p>
</li>
<li>
<p>While running an executable under gdb&rsquo;s control, you can add breakpoints in the program to ease the debugging process.
To add a breakpoint, type<br />$ break <span class="math"> &lt; </span>linenumber<span class="math"> &gt; </span></p>
</li>
<li>
<p>To run the code type<br />$ r</p>
</li>
<li>
<p>To continue running the program after a breakpoint is hit, type<br />$ c</p>
</li>
<li>
<p>To inspect the stack using gdb, type<br />$ backtrace or<br />$ backtrace full (to display contents of local variables)</p>
</li>
<li>
<p>To get information about individual frames, type<br /><code>$ info frame &lt; frame number &gt; </code><br />E.g., if you want to see information about frame 5 (assuming your program has made 6 recursive function calls, since frame number starts from 0), then the command would look like<br />$ info frame 5</p>
</li>
<li>
<p>To get size of a frame, subtract frame addresses of two consecutive frames.</p>
</li>
</ol>

<p>To find the size of an executable (including its code vs. data segments), consider using the <i>size</i> command. Look at its man pages.</p>
<p>To find PID of, say, prog2, type:<br />$ ps -ef | grep prog2 <br/>or<br />$ pgrep prog2</p>


<p>To find the size of code during run time, type the following while the code is in execution:<br />$ pmap PID | grep &ldquo;total&rdquo;<br />To see memory allocated to each section of the process, type<br />$ pmap PID</p>
<hr/>

<h3>Deliverables</h3>
You should do the task 1 below and answer three questions clearly and make .txt report file containing those answers and add this file to your project.
<p><strong>Task one:</strong> In <strong>prog1</strong> folder, the program prog1.c calls a recursive function which has a local and a dynamically allocated variable. This program will crash due a bug we have introduced into it. Use the Makefile that we have provided to compile the program and subsequently execute it.
The program will exit with an error printed on the console.
You are to compile the program with 32 bit and 64 bit options and carry out the following tasks separately for each:</p>
<ol>
<li>
<p>Observe and report the differences in the following for the 32 bit and 64 bit executables: (i) size of compiled code, (ii) size of code during run time, (iii) size of linked libraries.</p>
</li>
<li>
<p>Use gdb to find the program statement that caused the error.</p>
</li>
<li>
<p>Explain the cause of this error.</p>
</li>
</ol>
</li>

<hr/>
<h3>Pushing and Submitting Your Changes and Reports</h3>

<p>If you change an existing file or add a new file to your local repo, you must commit the changes and then push them to the remote repo. </p>
<p>First make sure you are at the correct branch as explained before and then follow the steps below:</p>
<p>Add files that have been created or have been changed:</p>

<p><code>$ git add &lt; list of file names separated by space &gt;</code></p>


<p>Commit the changes with a message about that change:</p>

<p><code>$ git commit -m "your proper commit message"</code></p>

<p>Finally push the changes to remote repo:</p>
<p><code>$ git push origin &lt; your-branch-name &gt;</code></p>

<h3> Merging your branches</h3>
 <p>After all team members are done with their work you need to merge your commits
 to the master branch. In order to merge a branch to the master branch, follow these steps:
 </p>
 <ol>
     <li> Go to the web page of your repository at https://github.com/psu473/px-< your-github-username > where $x$ is the project number (starting from 0).

     <li> Click on <i> Pull requests</i> tab and and then click on <i> New pull request</i> button.

     <li> In <i> compare</i> drop-down choose your branch

     <li> Click on <i> Create pull request</i> button and proceed the form

     <li> Click on <i> Merge pull request</i> button and then click on <i> Confirm merge</i>
 </ol>

 <i>*If you are in a group, as a good practice we recommend that members create their own branches and one of the members does Task 1 for -m64 and and the other does -m32 and then commit
 and push their changes and then finally merge your branches into the master branch.*</i>

<h3>Merge Conflicts</h3>
 <p> Merging two branches can raise conflicts. Git attempts to resolve them as much as possible. Sometimes you need to resolve the conflicts manually.</p>

<!-- <p>While merging two branches, there might be some conflicts between them. Git does its best to handle these conflicts as much as possible. However, sometimes you need to resolve the conflicts manually.</p> -->

 <p>In the step 4 (above) if Git cannot resolve the conflict, it asks you to resolve. Steps to resolve are as below:</p>
 <ol>
     <li> Click on <i> Resolve conflicts</i> button</li>
     <li> Resolve the conflicts as below:<br/>
     Git shows the conflicts in the following format:<br/>
     <p style="margin-right:2px">
     <<<<<<< < your branch ><br/>
     new changes in your branch<br/>
    =======<br/>
    lines in master branch which have conflict with yours<br/>
    >>>>>>> master<br/>
	</p>

<p>To resolve the conflict you should either accept the portion above "<i>=======</i>" or the portion below it. Once you decided on it, remove the other portion as well as "<i> <<<<<<< < your branch ></i>" and "<i>  >>>>>>> master</i>". Do this process for any other conflict in this file or other files.</p>
<p>     Finally click on <i>mark as resolved</i> button and then click on <i> commit merge</i> button. Now do the step 5 in above section (i.e Click on <i> Merge pull request</i> button and then click on <i>Confirm merge</i>)

</ol>
	<h3>Useful Materials</h3>
	If you need to know more about git, there are many awesome references that you can find online.<br/>
	<a href="https://rogerdudler.github.io/git-guide/">This</a> is a quick place to start. <br/>
	<a href="https://try.github.io/levels/1/challenges/1">Here</a> is an interactive game for learning git, try it! <br/>
	You can also find more references <a href="https://gist.github.com/jaseemabid/1321592">Here</a>.
